import { e as createComponent, f as createAstro, k as renderComponent, l as renderScript, r as renderTemplate, n as defineScriptVars, h as addAttribute, m as maybeRenderHead } from '../chunks/astro/server_sX7_rjgf.mjs';
import 'piccolore';
import { $ as $$Layout } from '../chunks/Layout_CgTu8x7F.mjs';
/* empty css                                    */
import { c as createSong } from '../chunks/songs_BZcFNsrW.mjs';
export { renderers } from '../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const $$AddSong = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$AddSong;
  const API_URL = "http://localhost:3000/api";
  const token = Astro2.cookies.get("token")?.value;
  if (!token) {
    return Astro2.redirect("/login");
  }
  let categories = [];
  try {
    const res = await fetch(`${API_URL}/categories`);
    if (res.ok) {
      categories = await res.json();
    }
  } catch (e) {
    console.error("Error fetching categories:", e);
  }
  let errorMessage = "";
  if (Astro2.request.method === "POST") {
    const formData = await Astro2.request.formData();
    const result = await createSong(formData, token);
    if (result.success) {
      return Astro2.redirect(`/songs/${result.data.id}`);
    } else {
      errorMessage = result.error || "Error desconocido";
    }
  }
  return renderTemplate`${renderComponent($$result, "Layout", $$Layout, { "title": "Subir Canción" }, { "default": async ($$result2) => renderTemplate(_a || (_a = __template([" ", '<div class="flex flex-col min-h-screen bg-bg-main text-text-main"> <main class="flex-1 max-w-6xl mx-auto w-full p-6 md:p-10"> <h1 class="text-3xl font-bold text-accent-main mb-8">\nEnviar Cifrado\n</h1> ', ' <form class="space-y-8" method="POST">  <div class="grid grid-cols-1 md:grid-cols-3 gap-6"> <div class="space-y-2"> <label for="artist" class="block text-sm font-medium text-text-secondary">Artista / Banda</label> <input type="text" id="artist" name="artist" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="Ej. Cindy Barrera"> </div> <div class="space-y-2"> <label for="title" class="block text-sm font-medium text-text-secondary">Nombre de la canción</label> <input type="text" id="title" name="title" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="Ej. Dios está aquí" required> </div> <div class="space-y-2"> <label for="key" class="block text-sm font-medium text-text-secondary">Tono Principal</label> <select id="key" name="key" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors appearance-none cursor-pointer"> <option value="C">C (Do)</option> <option value="C#">C# / Db</option> <option value="D">D (Re)</option> <option value="D#">D# / Eb</option> <option value="E">E (Mi)</option> <option value="F">F (Fa)</option> <option value="F#">F# / Gb</option> <option value="G">G (Sol)</option> <option value="G#">G# / Ab</option> <option value="A">A (La)</option> <option value="A#">A# / Bb</option> <option value="B">B (Si)</option> </select> </div> </div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div class="space-y-2"> <label for="url_song" class="block text-sm font-medium text-text-secondary">Link del Video (YouTube)</label> <input type="url" id="url_song" name="url_song" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="https://youtube.com/..."> </div> <div class="space-y-2"> <div class="flex justify-between items-center"> <label for="categoryId" class="block text-sm font-medium text-text-secondary">Categoría</label> <button type="button" id="btn-new-category" class="text-xs text-accent-main hover:text-white underline transition-colors">\n+ Nueva Categoría\n</button> </div> <select id="categoryId" name="categoryId" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors appearance-none cursor-pointer"> ', ' </select> </div> </div> <div class="border-t border-white/10 pt-6"> <div class="mb-4"> <h3 class="text-xl font-semibold text-white">\nLetra y Acordes\n</h3> <p class="text-sm text-text-secondary">\nEscribe la letra y usa los botones para insertar los\n                            acordes en la posición exacta.\n</p> </div>   ', ' </div> <div class="flex justify-end pt-4"> <button type="submit" class="bg-accent-main hover:bg-accent-main/90 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-lg shadow-accent-main/20">\nGuardar Canción\n</button> </div> </form> </main> </div> <dialog id="modal-category" class="bg-bg-secondary text-text-main border border-white/10 rounded-lg p-6 backdrop:backdrop-blur-sm shadow-xl w-full max-w-sm"> <form method="dialog" class="space-y-4"> <h3 class="text-lg font-bold">Nueva Categoría</h3> <div class="space-y-2"> <label for="new-cat-name" class="text-sm text-text-secondary">Nombre</label> <input type="text" id="new-cat-name" class="w-full bg-bg-main border border-white/10 rounded p-2 focus:border-accent-main focus:outline-none" placeholder="Ej. Adoración"> </div> <div class="flex justify-end gap-2 pt-2"> <button value="cancel" class="px-4 py-2 text-sm text-text-secondary hover:text-white transition-colors">Cancelar</button> <button id="btn-save-category" type="button" class="px-4 py-2 text-sm bg-accent-main text-white rounded hover:bg-accent-main/90 transition-colors">Guardar</button> </div> </form> </dialog> <script>(function(){', '\n        const btnNewCategory = document.getElementById("btn-new-category");\n        const modalCategory = document.getElementById("modal-category");\n        const btnSaveCategory = document.getElementById("btn-save-category");\n        const inputCatName = document.getElementById("new-cat-name");\n        const selectCategory = document.getElementById("categoryId");\n\n        if (btnNewCategory && modalCategory) {\n            btnNewCategory.addEventListener("click", () => {\n                modalCategory.showModal();\n                inputCatName.value = "";\n                inputCatName.focus();\n            });\n        }\n\n        if (btnSaveCategory) {\n            btnSaveCategory.addEventListener("click", async () => {\n                const name = inputCatName.value.trim();\n                if (!name) return;\n\n                try {\n                    btnSaveCategory.disabled = true;\n                    btnSaveCategory.textContent = "Guardando...";\n\n                    const res = await fetch(`${API_URL}/categories`, {\n                        method: "POST",\n                        headers: { "Content-Type": "application/json" },\n                        body: JSON.stringify({ name }),\n                    });\n\n                    if (res.ok) {\n                        const newCat = await res.json();\n                        // Agregar al select\n                        const option = document.createElement("option");\n                        option.value = newCat.id;\n                        option.textContent = newCat.name;\n                        option.selected = true; // Seleccionar automáticamente\n                        selectCategory.appendChild(option);\n\n                        modalCategory.close();\n                    } else {\n                        alert("Error al crear la categoría");\n                        console.error(await res.json());\n                    }\n                } catch (e) {\n                    console.error(e);\n                    alert("Error de conexión");\n                } finally {\n                    btnSaveCategory.disabled = false;\n                    btnSaveCategory.textContent = "Guardar";\n                }\n            });\n        }\n    })();</script> '], [" ", '<div class="flex flex-col min-h-screen bg-bg-main text-text-main"> <main class="flex-1 max-w-6xl mx-auto w-full p-6 md:p-10"> <h1 class="text-3xl font-bold text-accent-main mb-8">\nEnviar Cifrado\n</h1> ', ' <form class="space-y-8" method="POST">  <div class="grid grid-cols-1 md:grid-cols-3 gap-6"> <div class="space-y-2"> <label for="artist" class="block text-sm font-medium text-text-secondary">Artista / Banda</label> <input type="text" id="artist" name="artist" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="Ej. Cindy Barrera"> </div> <div class="space-y-2"> <label for="title" class="block text-sm font-medium text-text-secondary">Nombre de la canción</label> <input type="text" id="title" name="title" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="Ej. Dios está aquí" required> </div> <div class="space-y-2"> <label for="key" class="block text-sm font-medium text-text-secondary">Tono Principal</label> <select id="key" name="key" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors appearance-none cursor-pointer"> <option value="C">C (Do)</option> <option value="C#">C# / Db</option> <option value="D">D (Re)</option> <option value="D#">D# / Eb</option> <option value="E">E (Mi)</option> <option value="F">F (Fa)</option> <option value="F#">F# / Gb</option> <option value="G">G (Sol)</option> <option value="G#">G# / Ab</option> <option value="A">A (La)</option> <option value="A#">A# / Bb</option> <option value="B">B (Si)</option> </select> </div> </div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div class="space-y-2"> <label for="url_song" class="block text-sm font-medium text-text-secondary">Link del Video (YouTube)</label> <input type="url" id="url_song" name="url_song" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors placeholder-white/20" placeholder="https://youtube.com/..."> </div> <div class="space-y-2"> <div class="flex justify-between items-center"> <label for="categoryId" class="block text-sm font-medium text-text-secondary">Categoría</label> <button type="button" id="btn-new-category" class="text-xs text-accent-main hover:text-white underline transition-colors">\n+ Nueva Categoría\n</button> </div> <select id="categoryId" name="categoryId" class="w-full bg-bg-secondary border border-white/10 rounded-lg p-3 text-text-main focus:outline-none focus:border-accent-main transition-colors appearance-none cursor-pointer"> ', ' </select> </div> </div> <div class="border-t border-white/10 pt-6"> <div class="mb-4"> <h3 class="text-xl font-semibold text-white">\nLetra y Acordes\n</h3> <p class="text-sm text-text-secondary">\nEscribe la letra y usa los botones para insertar los\n                            acordes en la posición exacta.\n</p> </div>   ', ' </div> <div class="flex justify-end pt-4"> <button type="submit" class="bg-accent-main hover:bg-accent-main/90 text-white font-bold py-3 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-lg shadow-accent-main/20">\nGuardar Canción\n</button> </div> </form> </main> </div> <dialog id="modal-category" class="bg-bg-secondary text-text-main border border-white/10 rounded-lg p-6 backdrop:backdrop-blur-sm shadow-xl w-full max-w-sm"> <form method="dialog" class="space-y-4"> <h3 class="text-lg font-bold">Nueva Categoría</h3> <div class="space-y-2"> <label for="new-cat-name" class="text-sm text-text-secondary">Nombre</label> <input type="text" id="new-cat-name" class="w-full bg-bg-main border border-white/10 rounded p-2 focus:border-accent-main focus:outline-none" placeholder="Ej. Adoración"> </div> <div class="flex justify-end gap-2 pt-2"> <button value="cancel" class="px-4 py-2 text-sm text-text-secondary hover:text-white transition-colors">Cancelar</button> <button id="btn-save-category" type="button" class="px-4 py-2 text-sm bg-accent-main text-white rounded hover:bg-accent-main/90 transition-colors">Guardar</button> </div> </form> </dialog> <script>(function(){', '\n        const btnNewCategory = document.getElementById("btn-new-category");\n        const modalCategory = document.getElementById("modal-category");\n        const btnSaveCategory = document.getElementById("btn-save-category");\n        const inputCatName = document.getElementById("new-cat-name");\n        const selectCategory = document.getElementById("categoryId");\n\n        if (btnNewCategory && modalCategory) {\n            btnNewCategory.addEventListener("click", () => {\n                modalCategory.showModal();\n                inputCatName.value = "";\n                inputCatName.focus();\n            });\n        }\n\n        if (btnSaveCategory) {\n            btnSaveCategory.addEventListener("click", async () => {\n                const name = inputCatName.value.trim();\n                if (!name) return;\n\n                try {\n                    btnSaveCategory.disabled = true;\n                    btnSaveCategory.textContent = "Guardando...";\n\n                    const res = await fetch(\\`\\${API_URL}/categories\\`, {\n                        method: "POST",\n                        headers: { "Content-Type": "application/json" },\n                        body: JSON.stringify({ name }),\n                    });\n\n                    if (res.ok) {\n                        const newCat = await res.json();\n                        // Agregar al select\n                        const option = document.createElement("option");\n                        option.value = newCat.id;\n                        option.textContent = newCat.name;\n                        option.selected = true; // Seleccionar automáticamente\n                        selectCategory.appendChild(option);\n\n                        modalCategory.close();\n                    } else {\n                        alert("Error al crear la categoría");\n                        console.error(await res.json());\n                    }\n                } catch (e) {\n                    console.error(e);\n                    alert("Error de conexión");\n                } finally {\n                    btnSaveCategory.disabled = false;\n                    btnSaveCategory.textContent = "Guardar";\n                }\n            });\n        }\n    })();</script> '])), maybeRenderHead(), errorMessage ? renderTemplate`<div class="bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6"> ${errorMessage} </div>` : null, categories.map((cat) => renderTemplate`<option${addAttribute(cat.id, "value")}>${cat.name}</option>`), renderComponent($$result2, "ChordEditor", null, { "client:only": "react", "name": "content", "client:component-hydration": "only", "client:component-path": "@/components/ChordEditor.jsx", "client:component-export": "default" }), defineScriptVars({ API_URL })) })} ${renderScript($$result, "C:/dev/letras y acordes/letras-acordes/src/pages/add-song.astro?astro&type=script&index=0&lang.ts")}`;
}, "C:/dev/letras y acordes/letras-acordes/src/pages/add-song.astro", void 0);
const $$file = "C:/dev/letras y acordes/letras-acordes/src/pages/add-song.astro";
const $$url = "/add-song";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
    __proto__: null,
    default: $$AddSong,
    file: $$file,
    url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
