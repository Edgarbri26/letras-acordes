import{b as v,s as E,c}from"./alerts.CXiBSr95.js";import"./sweetalert2.esm.all.BbQndx0i.js";const f=document.getElementById("admin-config"),u=f?.getAttribute("data-api-url")||"http://localhost:3000/api",h=f?.getAttribute("data-token"),s=document.getElementById("userModal"),m=document.getElementById("userForm"),i=document.getElementById("modalTitle"),p=document.getElementById("openCreateModal"),w=document.getElementById("closeModal"),B=document.getElementById("cancelModalBtn"),d=e=>{e?(s?.classList.remove("hidden"),s?.classList.add("flex")):(s?.classList.add("hidden"),s?.classList.remove("flex"))};p?.addEventListener("click",()=>{m.reset(),document.getElementById("userId")?.setAttribute("value",""),i&&(i.textContent="Nuevo Usuario"),d(!0)});w?.addEventListener("click",()=>d(!1));B?.addEventListener("click",()=>d(!1));document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>{const t=JSON.parse(e.getAttribute("data-user")||"{}");i&&(i.textContent="Editar Usuario"),document.querySelector('[name="name"]').value=t.name,document.querySelector('[name="email"]').value=t.email,document.querySelector('[name="phoneNumber"]').value=t.phoneNumber||"",document.querySelector('[name="roleId"]').value=String(t.roleId),document.getElementById("userId")?.setAttribute("value",t.id),d(!0)})});document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",async()=>{if(!(await v("¿Eliminar usuario?","Esta acción es irrevocable.")).isConfirmed)return;const a=e.getAttribute("data-id");try{(await fetch(`${u}/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`}})).ok?(await E("Usuario eliminado"),window.location.reload()):c("Error","Error al eliminar")}catch(o){console.error(o),c("Error","Error de conexión")}})});m?.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(m),a=t.get("id"),o=!!a,n={};t.forEach((r,l)=>n[l]=r),n.password||delete n.password;const y=o?`${u}/users/${a}`:`${u}/users`,g=o?"PUT":"POST";try{const r=await fetch(y,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(n)});if(r.ok)await E(o?"Usuario actualizado":"Usuario creado"),window.location.reload();else{const l=await r.json();c("Error",l.error||"Error al guardar")}}catch(r){console.error(r),c("Error","Error de conexión")}});
