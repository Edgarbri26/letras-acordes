import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.WFquGv8Z.js";import{g as M}from"./misas.DRDL5bBN.js";import"./songs.Cv0urTgp.js";const I=()=>e.jsxs("div",{className:"block bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsx("div",{className:"h-7 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-6 w-6 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mt-3"})]});class o extends Error{}o.prototype.name="InvalidTokenError";function D(r){return decodeURIComponent(atob(r).replace(/(.)/g,(a,n)=>{let i=n.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function P(r){let a=r.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return D(a)}catch{return atob(a)}}function S(r,a){if(typeof r!="string")throw new o("Invalid token specified: must be a string");a||(a={});const n=a.header===!0?0:1,i=r.split(".")[n];if(typeof i!="string")throw new o(`Invalid token specified: missing part #${n+1}`);let g;try{g=P(i)}catch(c){throw new o(`Invalid token specified: invalid base64 for part #${n+1} (${c.message})`)}try{return JSON.parse(g)}catch(c){throw new o(`Invalid token specified: invalid json for part #${n+1} (${c.message})`)}}const $=({token:r})=>{const[a,n]=d.useState(!0),[i,g]=d.useState([]),[c,v]=d.useState(null),[y,f]=d.useState(!1);d.useEffect(()=>{if(r)try{const t=S(r);v(t.id||t.sub)}catch(t){console.error("Error decoding token:",t)}(async()=>{try{const{success:t,data:b}=await M(r);t&&b&&g(b)}catch(t){console.error("Error fetching misas:",t)}finally{n(!1)}})()},[r]);const w=s=>{const t=new Date(s);return s.length===10?new Date(s+"T00:00:00").toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):t.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})};if(a)return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[...Array(3)].map((s,t)=>e.jsx(I,{},t))});if(!a&&i.length===0)return e.jsxs("section",{className:"flex flex-col items-center justify-center h-full gap-3.5 min-h-[50vh]",children:[e.jsx("p",{className:"text-center text-gray-500",children:"No hay misas registradas."}),!r&&e.jsxs("p",{className:"text-center text-gray-500",children:["Inicia sesi√≥n para registrar misas.",e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-700 ml-1",children:"Iniciar Sesi√≥n"})]})]});const m=new Date;m.setHours(0,0,0,0);const j=i.filter(s=>s.userId===c),N=i.filter(s=>s.userId!==c&&s.visibility==="PUBLIC"),u=s=>s.sort((t,b)=>new Date(t.dateMisa)-new Date(b.dateMisa)),p=u(j.filter(s=>new Date(s.dateMisa)>=m)),l=u(j.filter(s=>new Date(s.dateMisa)<m)).reverse(),k=y?l:l.slice(0,6),x=u(N.filter(s=>new Date(s.dateMisa)>=m)),h=s=>e.jsxs("a",{href:`/misas/${s.id}`,className:"block bg-white dark:bg-gray-800 p-6 rounded-lg shadow hover:shadow-md transition border border-gray-200 dark:border-gray-700 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-2",children:s.visibility==="PUBLIC"?e.jsx("span",{className:"inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-accent-main ring-1 ring-inset ring-accent-main/20 dark:bg-accent-main/30 dark:text-accent-main",children:"P√∫blica"}):e.jsx("span",{className:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700",children:"Privada"})}),e.jsx("h3",{className:"text-xl font-bold mb-2 pr-12 text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:s.title}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:["üìÖ ",w(s.dateMisa)]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[s.misaSongs.length," canciones"]}),s.user&&s.userId!==c&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Por: ",s.user.name]})]})]},s.id);return e.jsxs("div",{className:"space-y-12",children:[(p.length>0||l.length>0)&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-gray-800 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-2",children:"Mis Misas"}),p.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-accent-main dark:text-accent-main flex items-center gap-2",children:"Pr√≥ximas"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(h)})]}),l.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-500 flex items-center gap-2",children:[e.jsx("span",{children:"history"})," Anteriores"]}),!y&&l.length>6&&e.jsx("button",{onClick:()=>f(!0),className:"text-accent-main hover:text-accent-main text-sm font-medium hover:underline",children:"Ver todas ‚Üí"})]}),e.jsx("div",{className:"grid gap-4 opacity-80 hover:opacity-100 transition-opacity sm:grid-cols-2 lg:grid-cols-3",children:k.map(h)}),y&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 text-sm hover:underline",children:"Ver menos"})})]})]}),x.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-gray-800 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-2",children:"Misas P√∫blicas"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map(h)})]}),!r&&x.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-100",children:"Pr√≥ximas Misas P√∫blicas"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map(h)})]})]})};export{$ as default};
