import{S as a}from"./sweetalert2.esm.all.BbQndx0i.js";const d=document.getElementById("roles-page"),c=d?.dataset.apiUrl,l=d?.dataset.token,s=document.getElementById("saveBtn"),u=document.getElementById("createRoleBtn"),m=document.querySelectorAll(".edit-role-btn"),p=document.querySelectorAll('input[type="checkbox"][data-role-id]'),n={background:"#1f2937",color:"#fff",confirmButtonColor:"#f97316",cancelButtonColor:"#4b5563"};u?.addEventListener("click",async()=>{const{value:e}=await a.fire({...n,title:"Crear Nuevo Rol",input:"text",inputLabel:"Nombre del Rol",inputPlaceholder:"Ej: MUSICO",showCancelButton:!0,inputValidator:t=>{if(!t)return"¡Debes escribir un nombre!"}});if(e)try{const t=await fetch(`${c}/roles`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({name:e.toUpperCase(),permissions:[]})});if(t.ok)a.fire({...n,icon:"success",title:"¡Éxito!",text:"Rol creado correctamente"}).then(()=>window.location.reload());else{const r=await t.json().catch(()=>({}));throw new Error(r.error||"Error al crear rol")}}catch(t){console.error(t),a.fire({...n,icon:"error",title:"Error",text:t instanceof Error?t.message:"No se pudo crear el rol"})}});m.forEach(e=>{e.addEventListener("click",async()=>{if(!(e instanceof HTMLElement))return;const t=e.dataset.roleId,r=e.dataset.roleName,{value:o}=await a.fire({...n,title:"Editar Nombre del Rol",input:"text",inputValue:r,showCancelButton:!0,inputValidator:i=>{if(!i)return"¡El nombre no puede estar vacío!"}});if(o&&o!==r)try{if((await fetch(`${c}/roles/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({name:o.toUpperCase()})})).ok)a.fire({...n,icon:"success",title:"Actualizado",text:"Nombre del rol actualizado"}).then(()=>window.location.reload());else throw new Error("Error al actualizar")}catch(i){console.error(i),a.fire({...n,icon:"error",title:"Error",text:"No se pudo actualizar el rol"})}})});s?.addEventListener("click",async()=>{s.disabled=!0,s.innerText="Guardando...";try{const e={};p.forEach(r=>{const o=r.dataset.roleId,i=r.dataset.permName;!o||!i||(e[o]||(e[o]=[]),r.checked&&e[o].push(i))});const t=Object.keys(e).map(async r=>{if(!(await fetch(`${c}/roles/${r}/permissions`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({permissionNames:e[r]})})).ok)throw new Error(`Error updating role ${r}`)});await Promise.all(t),a.fire({...n,icon:"success",title:"Permisos Actualizados",text:"Los cambios se guardaron correctamente."}).then(()=>{window.location.reload()})}catch(e){console.error(e),a.fire({...n,icon:"error",title:"Error",text:"Hubo un problema al guardar los permisos."}),s.disabled=!1,s.innerText="Guardar Cambios"}});
