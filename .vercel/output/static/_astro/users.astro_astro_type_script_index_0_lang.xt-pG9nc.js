import{s as p,a as E,b as i}from"./alerts.B2mnkYRv.js";import"./sweetalert2.esm.all.BbQndx0i.js";const f=document.getElementById("admin-config"),l=f?.getAttribute("data-api-url")||"http://localhost:3000/api",h=f?.getAttribute("data-token"),s=document.getElementById("userModal"),u=document.getElementById("userForm"),d=document.getElementById("modalTitle"),v=document.getElementById("openCreateModal"),w=document.getElementById("closeModal"),m=e=>{e?(s?.classList.remove("hidden"),s?.classList.add("flex")):(s?.classList.add("hidden"),s?.classList.remove("flex"))};v?.addEventListener("click",()=>{u.reset(),document.getElementById("userId")?.setAttribute("value",""),d&&(d.textContent="Nuevo Usuario"),m(!0)});w?.addEventListener("click",()=>m(!1));document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",()=>{const t=JSON.parse(e.getAttribute("data-user")||"{}");d&&(d.textContent="Editar Usuario"),document.querySelector('[name="name"]').value=t.name,document.querySelector('[name="email"]').value=t.email,document.querySelector('[name="phoneNumber"]').value=t.phoneNumber||"",document.querySelector('[name="roleId"]').value=String(t.roleId),document.getElementById("userId")?.setAttribute("value",t.id),m(!0)})});document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",async()=>{if(!(await p("¿Eliminar usuario?","Esta acción es irrevocable.")).isConfirmed)return;const a=e.getAttribute("data-id");try{(await fetch(`${l}/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`}})).ok?(await E("Usuario eliminado"),window.location.reload()):i("Error","Error al eliminar")}catch(o){console.error(o),i("Error","Error de conexión")}})});u?.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(u),a=t.get("id"),o=!!a,n={};t.forEach((r,c)=>n[c]=r),n.password||delete n.password;const y=o?`${l}/users/${a}`:`${l}/users`,g=o?"PUT":"POST";try{const r=await fetch(y,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(n)});if(r.ok)await E(o?"Usuario actualizado":"Usuario creado"),window.location.reload();else{const c=await r.json();i("Error",c.error||"Error al guardar")}}catch(r){console.error(r),i("Error","Error de conexión")}});
