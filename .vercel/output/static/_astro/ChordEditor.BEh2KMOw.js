import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.WFquGv8Z.js";import{a as N,t as g}from"./music.CRsQeu5U.js";import{S as k}from"./SongLine.Pob6Upoq.js";const T=["C","D","E","F","G","A","B","Cm","Dm","Em","Am","Bm"];function S({onTranspose:x,onInsertChord:m,onInsertSection:l}){return t.jsxs("div",{className:"flex flex-wrap gap-2 p-2 bg-white/5 rounded-lg border border-white/10 items-center",children:[t.jsxs("div",{className:"flex gap-1 mr-4 border-r border-white/10 pr-4",children:[t.jsx("button",{type:"button",onClick:()=>x(-1),className:"px-3 py-1 text-sm font-bold text-white bg-red-500/80 hover:bg-red-600 rounded transition-colors",title:"Bajar medio tono",children:"- ½ Tono"}),t.jsx("button",{type:"button",onClick:()=>x(1),className:"px-3 py-1 text-sm font-bold text-white bg-green-500/80 hover:bg-green-600 rounded transition-colors",title:"Subir medio tono",children:"+ ½ Tono"})]}),t.jsxs("div",{className:"flex gap-1 mr-4 border-r border-white/10 pr-4",children:[t.jsx("button",{type:"button",onClick:()=>l&&l("Estrofa"),className:"px-3 py-1 text-sm font-bold text-white bg-blue-500/80 hover:bg-blue-600 rounded transition-colors",title:"Insertar Estrofa",children:"Estrofa"}),t.jsx("button",{type:"button",onClick:()=>l&&l("Coro"),className:"px-3 py-1 text-sm font-bold text-white bg-purple-500/80 hover:bg-purple-600 rounded transition-colors",title:"Insertar Coro",children:"Coro"})]}),t.jsx("span",{className:"text-xs text-white/50 flex items-center mr-2",children:"Insertar:"}),T.map(i=>t.jsx("button",{type:"button",onClick:()=>m(i),className:"px-3 py-1 text-sm font-bold text-text-main bg-bg-secondary hover:bg-accent-main hover:text-white border border-white/10 rounded transition-colors",children:i},i))]})}function D({name:x="content",initialContent:m="",initialKey:l="C"}){const[i,c]=d.useState(m),[R,b]=d.useState(l),u=d.useRef(l),h=d.useRef(null);d.useEffect(()=>{const o=n=>{const s=n.detail.key,r=u.current;r!==s&&(c(a=>N(a,r,s)),b(s),u.current=s)},e=n=>{n.detail&&n.detail.content&&c(n.detail.content)};return window.addEventListener("song-key-change",o),window.addEventListener("update-editor-content",e),()=>{window.removeEventListener("song-key-change",o),window.removeEventListener("update-editor-content",e)}},[]);const w=o=>{const e=h.current;if(!e)return;const n=e.selectionStart,s=e.selectionEnd,r=e.value,a=r.substring(0,n)+`[${o}]`+r.substring(s);c(a),setTimeout(()=>{e.focus(),e.setSelectionRange(n+o.length+2,n+o.length+2)},0)},v=o=>{const e=i.replace(/\[(.*?)\]/g,(s,r)=>`[${g(r,o)}]`);c(e);const n=g(u.current,o);u.current=n,b(n),window.dispatchEvent(new CustomEvent("editor-key-change",{detail:{key:n}}))},y=o=>{const e=h.current;if(!e)return;const n=e.selectionStart,s=e.selectionEnd,r=e.value;let a="";if(o==="Coro")a=`{c: Coro}
`;else if(o==="Estrofa"){const E=[...r.matchAll(/\{c:\s*Estrofa\s*(\d+)\}/gi)];let f=0;E.forEach(j=>{const p=parseInt(j[1],10);!isNaN(p)&&p>f&&(f=p)}),a=`{c: Estrofa ${f+1}}
`}const C=r.substring(0,n)+a+r.substring(s);c(C),setTimeout(()=>{e.focus(),e.setSelectionRange(n+a.length,n+a.length)},0)};return t.jsxs("div",{className:"space-y-4",children:[t.jsx("input",{type:"hidden",name:x,value:i}),t.jsx(S,{onTranspose:v,onInsertChord:w,onInsertSection:y}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"flex flex-col h-[400px] lg:h-[500px]",children:[t.jsx("label",{className:"text-sm font-medium text-text-secondary mb-2",children:"Editor (Código)"}),t.jsx("textarea",{ref:h,value:i,onChange:o=>c(o.target.value),className:"w-full flex-1 bg-bg-secondary border border-white/10 rounded-lg p-4 font-mono text-sm text-text-main focus:outline-none focus:border-accent-main resize-none placeholder-white/20",placeholder:`Escribe la letra aquí y presiona los botones de acordes para insertar y los botones de secciones para insertar coro o estrofa...
Ejemplo:
 {c: Estrofa 1}
 Dios es[C]ta aqui`})]}),t.jsxs("div",{className:"flex flex-col h-[400px] lg:h-[500px]",children:[t.jsx("label",{className:"text-sm font-medium text-text-secondary mb-2",children:"Vista Previa (En vivo)"}),t.jsx("div",{className:"w-full flex-1 bg-[#fffbf6] text-gray-900 border border-white/10 rounded-lg p-6 overflow-y-auto shadow-inner",children:i.split(`
`).map((o,e)=>t.jsx(k,{line:o},e))})]})]})]})}export{D as default};
