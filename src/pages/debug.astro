---
export const prerender = false;
const API_URL = import.meta.env.PUBLIC_API_URL;
const NODE_ENV = import.meta.env.MODE;
---

<html>
    <head>
        <title>Debug Page</title>
    </head>
    <body style="font-family: monospace; padding: 2rem;">
        <h1>Debug Status</h1>
        <ul>
            <li><strong>Time:</strong> {new Date().toISOString()}</li>
            <li><strong>Environment:</strong> {NODE_ENV}</li>
            <li>
                <strong>API URL Configured:</strong>
                {API_URL ? "YES" : "NO"}
            </li>
            <li><strong>API URL Value:</strong> {API_URL}</li>
        </ul>
        <hr />
        <h2>Connectivity Test</h2>
        <p>Attempting to fetch backend...</p>
        <pre id="fetch-result">Loading...</pre>

        <script define:vars={{ API_URL }}>
            const pre = document.getElementById("fetch-result");
            if (!API_URL) {
                pre.textContent = "FATAL: PUBLIC_API_URL is missing in client.";
            } else {
                fetch(`${API_URL}/`)
                    .then((res) => {
                        pre.textContent = `Status: ${res.status} ${res.statusText}`;
                        return res.text();
                    })
                    .then((txt) => {
                        pre.textContent += `\nResponse: ${txt}`;
                    })
                    .catch((err) => {
                        pre.textContent = `Error: ${err.message}`;
                    });
            }
        </script>
    </body>
</html>
